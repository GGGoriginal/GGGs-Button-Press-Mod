using BepInEx;
using HarmonyLib;
using System;
using System.Reflection;
using UnityEngine;
using UnityEngine.InputSystem;
using Utilla;

namespace GGG_FRECAM
{
    [BepInPlugin(PluginInfo.Guid, PluginInfo.Name, PluginInfo.Version)]
    public class GGG_FRECAM : BaseUnityPlugin
    {
        void Awake()
        {
            new Harmony(PluginInfo.Guid).PatchAll(Assembly.GetExecutingAssembly());
        }

        void FixedUpdate()
        {
            if (Mouse.current.leftButton.wasPressedThisFrame)
            {
                Ray ray;
                LayerMask mask = LayerMask.GetMask(new string[] { "Gorilla Trigger", "Zone", "Gorilla Body"});
                if (GorillaTagger.Instance.thirdPersonCamera.activeInHierarchy)
                {
                    ray = GorillaTagger.Instance.thirdPersonCamera.GetComponentInChildren<Camera>().ScreenPointToRay(Mouse.current.position.value);
                }
                else
                {
                    ray = Camera.main.ScreenPointToRay(Mouse.current.position.value);
                }

                if (Physics.Raycast(ray, out RaycastHit hit, 5f, ~mask))
                {
                    GorillaTagger.Instance.rightHandTriggerCollider.transform.position = hit.point;
                }
            }
        }
    }
}
